% !TeX encoding = UTF-8
% !TeX spellcheck = en_GB
% !TeX root = ../thesis.tex

\chapter{Related Work}
\label{chapter:related_work}

In the recent years, as indicated in previous chapters, the reliance on mobile devices has significantly increased within enterprises. However, usage of mobile devices is not limited for enterprise networks and it plays a huge role as an inevitable contributor to our daily lives. Therefore, it is of utmost importance not only for enterprises but also individuals to be able to ensure the security of their mobile devices. As a result, a wide range of network monitoring and inspection applications have been developed to enable researchers to capture, inspect, and also analyse network traffic generated by mobile applications.

Network monitoring and inspection solutions are essential to detect suspicious communication patterns, privacy leakages, and network and application-related anomalies that may compromise user data and the enterprise's system integrity.

Among a large number of prominent solutions developed in this area, \textbf{PCAPdroid, MopEye}, and \textbf{AntMonitor} have illustrated notable progress towards enhancing transparency along with control over mobile network traffic. PCAPdroid provides a non-root approach towards packet capture and employs Android's VpnService API to intercept and record traffic in PCAP/PCAPNG format allowing comprehensive network inspection without the need for elevated privileges. On the other hand, MopEye aims its focus towards large-scale network measurements and data aggregation for further research and monitoring purposes. It considerably contributes to mobile network performance and security. AntMonitor however, takes a privacy-oriented approach by enabling real-time analysis of application traffic, providing thorough visibility into how user data is transmitted over a network.

These existing tools have constructively contributed to the advancement of mobile traffic analysis. However, each of them also presents limitations in terms of integration, flexibility, and real-time threat intelligence and detection. The following sections provide an overview in details, highlighting their architectures, capabilities along with their constraints, which consequently became the motivating factors for Threat Detector development.


\section{PCAPdroid} 
As one of the most recognized open-source Android applications for capturing and analysing network traffic, PCAPdroid operates entirely without root privileges by leveraging Android's VpnService API. This results in the redirection of all network packets through a local virtual interface, allowing PCAPdroid to passively sniff and monitor network traffic. Moreover, it can log and export captured network traffic in the form of PCAP/PCAPNG files; consequently, making it compatible with standard packet analysis tools such as Wireshark or \emph{tshark}\footnote{\url{https://tshark.dev/}}. 

When it comes to PCAPdroid's architecture, it establishes a user-space VPN that intercepts both TCP and UDP packets. Once these packets are captured they are parsed locally or can be transferred to a remote system for further analysis as data streams in real-time. This is the very characteristic of PCAPdroid that makes it an efficient bridge between on-device data collection and remote analysis systems. This design enables PCAPdroid to include support for packet filtering, payload decoding, and also per-application traffic mapping. This, as mentioned before, takes place by correlating sockets with applications' UIDs.

PCAPdroid's primary advantage lies within its non-root nature, making it an attractive option for users, enterprises, and researches who cannot or do not wish for a drastic modification in their device operating system. Worth to mention that mission of such applications is to assist securing mobile devices and rooting or jail-breaking removes the security measures implemented on those devices, making them susceptible and puts them in significant risk of attacks. While providing a functional application without rooting the device, PCAPdroid also maintains the balance between technical depth by visualizing live traffic statistics and sustaining the compatibility with standard PCAP/PCAPNG workflow. These can be observed in the screenshot of PCAPdroid's settings in the previous chapter and also in \cref{fig:PCAPdroid_Scressnshots}.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.4\textwidth}
		\centering
		\includegraphics[width = \textwidth]{PCAPdroid_Connections_Screenshot.jpg}
		\caption{PCAPdroid Connections Page}
		\label{fig:PCAPdroid_Connections_Page}
	\end{subfigure}
	\begin{subfigure}{0.4\textwidth}
		\centering
		\includegraphics[width = \textwidth]{PCAPdroid_Connection_Details_Screenshot.jpg}
		\caption{PCAPdroid Connection Details Page}
		\label{fig:PCAPdroid_Connection_Details}
	\end{subfigure}
	\caption{Screenshots from PCAPdroid \cite{PCAPdroidUserGuide}}
	\label{fig:PCAPdroid_Scressnshots}
\end{figure}

%\todo{add citation and reference for the images}

While providing considerable advantages and the foundation for other network analysis tools to build upon, PCAPdroid was not originally designed for threat detection and intrusion analysis. Even though it captures traffic effectively, it does not incorporate mechanism to identify malicious patterns, command-and-control connection attempts, and data exfiltration. Moreover, the VPN-based model implemented in PCAPdroid introduces a minor performance overhead that stems from its interception model. This may cause it to interfere with some network applications that follow strict network policies and use encrypted VPN tunnelling techniques.


Despite the limitations, PCAPdroid remains a solid tool for Android network traffic analysis. Its modular design that follows PCAP/PCAPNG formatting alongside being an ideal foundation for other solutions to implement its open-source core, make it a reliable underlying base for other applications such as Thread Detector to extend its functionality.


\section{AntMonitor}
While introduced as an alternative for PCAPdroid on its \emph{GitHub page}\footnote{\url{https://github.com/UCI-Networking-Group/AntMonitor}}, AntMonitor represents a slightly different approach towards mobile traffic monitoring and analysis. Its focus lies mainly on privacy protection and transparency for end users. Developed by researchers at the University of California, AntMonitor was developed both as a research platform and privacy-enhancing tool. The goal it aims to achieve is to assist users understanding the workings behind how an application sends personal data across networks, in particular to third-party domains and analytic services.

Similar to PCAPdroid, AntMonitor heavily relies on Android's VpnService API to capture network packets. Moreover, it represents a more privacy-aware architecture, implementing modules covering real-time packet analysis. These modules classify network flows, detect leakage of sensible information such as Personally-Identifiable-Information (PII), and also visualize the communication between a device and a remote server.

In \cref{fig:AntMonitor Privacy-aware Architecture} you can see the privacy-awareness implementation.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.27\textwidth}
		\centering
		\includegraphics[width = \textwidth]{AntMonitor_Privacy_Exposure_History.png}
		\caption{Privacy Exposure History}
		\label{fig:AntMonitor_Privacy_Exposure_History}
	\end{subfigure}
	\begin{subfigure}{0.27\textwidth}
		\centering
		\includegraphics[width = \textwidth]{AntMonitor_Privacy_Exposure_Report.png}
		\caption{Privacy Exposure Report}
		\label{fig:AntMonitor_Privacy_Exposure_Report}
	\end{subfigure}
	\centering
	\begin{subfigure}{0.27\textwidth}
		\centering
		\includegraphics[width = \textwidth]{AntMonitor_Privacy_Exposure_Info.png}
		\caption{Privacy Exposure Information}
		\label{fig:AntMonitor_Privacy_Exposure_Info}
	\end{subfigure}
	\caption{Screenshots from AntMonitor Privacy-aware Architecture \cite{AntmonitorWebsite}}
	\label{fig:AntMonitor Privacy-aware Architecture}
\end{figure}

AntMonitor also features a framework for server-side traffic analysis. It accumulates anonymized data from multiple devices to build global statistics about mobile data leakages and application behaviours. This can be considered as a hybrid approach to combine local inspection with cloud-based aggregation, allowing scaling of  modern mobile privacy studies.

In \cref{fig:AntMonitor Logging Features} you can see the aggregation options regarding anonymized logs and the applications contributing to them.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\centering
		\includegraphics[width = \textwidth]{AntMonitor_Log_Contribution_Settings.png}
		\caption{AntMonitor Log Contribution Settings}
		\label{fig:AntMonitor_Log_Contribution_Settings}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\centering
		\includegraphics[width = \textwidth]{AntMonitor_Logs_Applications.png}
		\caption{AntMonitor Applications for Logging}
		\label{fig:AntMonitor_Applications_for_Logging}
	\end{subfigure}
	\caption{Screenshots from AntMonitor Logging Capabilities \cite{AntmonitorWebsite}}
	\label{fig:AntMonitor Logging Features}
\end{figure}

One of AntMonitor's key strengths is its focus on privacy awareness of end users. It provides the user with detailed insights about what sorts of information an application is transmitting and subsequently assists the user to make informed decisions about permissions and trustworthiness of that application. This privacy-centric approach however, introduces some notable trade-offs. In this design, data protection and user consent are prioritized, which limits AntMonitor's applicability for low-level packet inspection and complicates security research that require intense packet analysis. Additionally, AntMonitor's architecture is not designed with real-time threat detection and IP blocking capabilities in mind. This makes it less suitable for use cases involving direct intrusion detection.

As a brief summary, AntMonitor depicts a significant advancement in privacy-preserving traffic analysis but suffers from the lack of mechanisms to prevent active threats. Nonetheless, the principles employed in its design such as on-device analysis for mobile platforms and user transparency, have subsequently inspired the development of Threat Detector, which combines security analytics along with privacy awareness.



\section{MopEye}
Another research-oriented attempt aimed at large-scale mobile network monitoring is  \emph{MopEye}\footnote{\url{https://www4.comp.polyu.edu.hk/~csrchang/MopEye.pdf}}\cite{wu2016mopeyemonitoringperappnetwork}. Unlike AntMonitor and PCAPdroid that focus on applications for per-device traffic inspection, MopEye performs as a distributed network measurement platform that enables researchers to collect data across various mobile devices within different networks.

The mission it aims to accomplish is to understand the performance, security characteristics, and reliability of mobile networks, allowing participants to carry out experiments that measure parameters including packet latency, loss throughput, and DNS query behaviour. It is also known to be a metadata-collecting platform aggregating data about network configurations and signal strength which are vital for assessing real world network conditions.

\cref{fig:Screenshots_from_MopEye} illustrates MopEye's functionality.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\centering
		\includegraphics[width = \textwidth]{MopEye_1.png}
		\caption{MopEye Network Performance page}
		\label{fig:MopEye_Network_Performance_page}
	\end{subfigure}
	\begin{subfigure}{0.49\textwidth}
		\centering
		\includegraphics[width = \textwidth]{MopEye_2.png}
		\caption{MopEye Application Performance page}
		\label{fig:MopEye_Application_Performance_page}
	\end{subfigure}
	\caption{Screenshots from MopEye \cite{203263}}
	\label{fig:Screenshots_from_MopEye}
\end{figure}

From a technical viewpoint, MopEye implements a client-server architecture, in which mobile clients perform network measurements, followed by a report that is sent to centralized servers. It provides APIs for task scheduling, result collection and its visualization. Moreover, MopEye is designed in a way that makes it suitable for crowdsourced network monitoring and therefore, has been used in various studies concerning mobile security and performance anomaly detection.

\clearpage

However, as a solution primarily focused on macroscopic network traffic analysis, it does not provide packet-level inspection. It neither captures/inspects individual packet flows, nor does it identify suspicious or privacy-violating communication flows. In spite of the fact that it offers valuable insights about the overall network health, its capabilities are undoubtedly limited when it comes to device-level security and malware detection. However, despite aforementioned constraints, MopEye provides a strong underlying foundation in understanding the broader mobile network context, in which they operate. MopEye complements other monitoring tools such as PCAPdroid and AntMonitor that inspect network traffic on a microscopic level. Insights and network metadata provided by MopEye, can inform threat detection models by supplying background data about normal network performance and connectivity patterns.


\section{Comparison}
Even though PCAPdroid, AntMonitor, and MopEye share common goals to achieve, increasing visibility of mobile network traffic, their objectives and design philosophies are substantially different.

In the following table you can observe their functionalities and subsequent differences.

\begin{table}[H]
	\centering
	\caption{Comparison of Existing Mobile Network Monitoring Tools, Own Creation}
	\label{tab:comparison_tools}
	\resizebox{\textwidth}{!}{
		\begin{tabular}{@{}p{2cm}p{3cm}p{3cm}p{3cm}p{2.5cm}p{2.5cm}p{2cm}@{}}
			\toprule
			\textbf{Tool} & \textbf{Main Purpose} & \textbf{Focus} & \textbf{Real-Time Detection} & \textbf{Privacy Protection} & \textbf{Data Format} \\ \midrule
			\textbf{PCAPdroid} & Packet capture and export & Network analysis & No & Moderate & PCAP \\
			
			\midrule
			
			\textbf{AntMonitor} & Privacy-aware traffic inspection & Data leakage and app transparency & Partial & Strong & Internal database \\
			
			\midrule
			
			\textbf{MopEye} & Network measurement and performance & Large-scale monitoring & No & Limited & Aggregated metrics \\ 
			
			\midrule
			
			\textbf{Threat Detector} & Live threat detection & App-specific threat extraction & Comprehensive & Strong & JSON \\ \bottomrule
		\end{tabular}
	}
\end{table}


As illustrated in table 3.1, PCAPdroid excels in network visibility on packet-level, making it a suitable option for forensic or research-centric traffic analysis. On the other hand however, it lacks intelligence for automatic threat detection and classification. AntMonitor brings along useful user privacy insights but does not incorporate extensive traffic inspection, neither does it support automatic response mechanisms. As a contributor to macroscopic network analytics, MopEye provides complementary information about the overall network condition but does not highlight application-specific data.

In contrast however, Threat Detector developed in this thesis aims to accomplish what the above-mentioned solutions lack in their implementation. It seeks to bridge the gap between passive network traffic monitoring and active threat detection. By integrating the packet-capture capabilities provided by PCAPdroid with additional intelligence modules to query external threat intelligence sources (e.g. AbuseIPDB), Threat Detector improves security awareness on the device. The integration of PCAPdroid and Threat Detector enables real-time detection of suspicious IPs, provides mapping functionality to associate network packets with their originating application, addressing some of the limitations observed in existing tools.

\section{Scientific Literature}
This section goes through some of the scientific literatures that have taken a similar approach towards the implementation of malware and threat detection on Android devices.

In addition to the static and dynamic malware detection approaches, recent literature has increasingly focused on techniques that leverage network traffic with behavioural features for a more comprehensive detection. As an instance, a hybrid-Falcon framework integrates dynamic network traffic features with static code graphs, which transforms the flows into a 2D image representation. It uses a neural network graph to achieve a malware detection accuracy of over 90\%. Additionally, it has a family categorization of the detected threat with the accuracy over 80\% \cite{xu2022hybridfalconhybridpatternmalware}. A similar work from Muzaffar et al. and Hani Ragab Hassan shows that while static features alone can achieve a high accuracy, TCP network analysis belongs to the most reliable and predictive dynamic features that can be of use to determine the potential threats \cite{muzaffar2025reassessingfeaturebasedandroidmalware}.

Graph-based techniques have also shown promising results. For example, HAWK \cite{hei2021hawkrapidandroidmalware} models android applications behaviour as a heterogeneous information network (HIN) while utilising  graph attention networks to perform incremental learning for malware detection, reaching a rapid detection time (avg. 3.5 ms). Another related work to HAWK is NT-GNN \cite{Liu2023}. It constructs a traffic graph representation, enabling graph-neural-network detection of Android malware in Android and IoT environments. As another example of  graph-based implementation, Andro-Simnet \cite{Kim_2018} applies social network analysis approaches to compute similarities between malware families.

Beyond graph-based and hybrid methods mentioned above, researchers have also delved into deep learning on sequential traffic data. In a paper from Fallah and Bidgoly \cite{Fallah2022} an LSTM-based model is proposed that treats network flows as sequences. This approach not only allows binary malware detection, but also family identification achieving very high AUC (Area Under Curve) metrics in the captured data. In a more recent work \cite{Naseer2025} containing the integration of Large Language Models (GPT-2) data scarcity was addressed to generate synthetic TCP malware traffic followed by malware family classification to overcome privacy and sampling limitations in real-world datasets.

Another interesting approach \cite{Demmese2023} took the direction of image-based traffic visualization. In this paper, network traffic is converted into images that capture statistical patterns which are then used as input for Machine Learning classifiers. This approach has achieved over 99\% of accuracy in detecting \emph{fileless malware}\footnote{\url{https://en.wikipedia.org/wiki/Fileless_malware}}.

Furthermore, researchers have also explored more typical category-based malware detection, determining not only the presence of malware but its type (e.g adware, ransomware, banking trojans). For instance, Manzil and Naik have proposed a feature-vector generation method based on Huffman encoding of system call frequencies achieving over 98\% of malware categorization \cite{Manzil2023}.

Moreover on network behaviour analysis, Zhenxiang Chen. investigates the first few minutes of network behaviour analysing various features like DNS query patterns, HTTP packets lengths, and upload/download ratios. The trace analysis shows that more than 70\% of malware generate detectable traffic \cite{Chen2015}.

\clearpage

\section{Summary}
This chapter represented an overview of research efforts and their subsequent results in regard to mobile traffic monitoring and network packet analysis. PCAPdroid supplies a robust, open-source approach towards network packet and application level analysis while eliminating the need for rooting the device. AntMonitor highlights the user privacy as its primary mission, while MopEye contributes to large-scale network performance analysis.

While each of the mentioned tools has advanced the field of mobile security in particular ways, their combined limitations including lack of real-time threat detection, absence of application/IP blocking, and restricted integration capabilities underline the need for a more comprehensive solution. Threat Detector is built upon their foundation and aims to provide a hybrid model, integrating real-time threat detection, application-to-IP mapping, alongside flexibility to be interoperable with existing tools such as PCAPdroid.

The following chapters in this paper elaborate on the implementation of Threat Detector, explaining how its architectrual design overcomes the identified gaps in the existing tools.



